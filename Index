<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Imunisasi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .nav-item.active-page {
            font-weight: bold;
            color: #1e40af;
            border-bottom: 2px solid #1e40af;
        }
        .card { background: white; border-radius: 0.75rem; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,.1); }
        .page.hidden { display: none; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #e5e7eb; padding: 0.5rem; text-align: left; }
        th { background: #f3f4f6; }
    </style>
</head>
<body class="bg-gray-100 font-sans">

<div class="container mx-auto p-4 md:p-8">
    <!-- Navigation -->
    <header class="bg-white card mb-6 flex flex-wrap justify-center space-x-6">
        <a class="nav-item active-page" data-page="dashboard">Dasbor</a>
        <a class="nav-item" data-page="input-data">Input Data</a>
        <a class="nav-item" data-page="rekap">Rekap</a>
    </header>

    <!-- Dashboard -->
    <div id="dashboard" class="page">
        <div class="card text-center">
            <h2 class="text-2xl font-bold mb-2">Selamat Datang</h2>
            <p>Kelola data imunisasi anak dengan mudah dan efisien.</p>
        </div>
    </div>

    <!-- Input Data -->
    <div id="input-data" class="page hidden">
        <div class="card">
            <h2 class="text-xl font-bold mb-4">Formulir Imunisasi</h2>
            <form id="imunisasiForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label>Tanggal Imunisasi</label>
                    <input type="date" name="tglImunisasi" class="w-full border p-2 rounded" required>
                </div>
                <div>
                    <label>NIK Anak</label>
                    <input type="text" name="nikAnak" class="w-full border p-2 rounded" required>
                </div>
                <div>
                    <label>Nama Bayi</label>
                    <input type="text" name="namaBayi" class="w-full border p-2 rounded" required>
                </div>
                <div>
                    <label>NIK Ibu</label>
                    <input type="text" name="nikIbu" class="w-full border p-2 rounded" required>
                </div>
                <div>
                    <label>Tanggal Lahir</label>
                    <input type="date" name="tglLahir" class="w-full border p-2 rounded" required>
                </div>
                <div>
                    <label>Umur</label>
                    <input type="text" name="umur" class="w-full border p-2 rounded" readonly>
                </div>
                <div>
                    <label>Panjang Badan (cm)</label>
                    <input type="number" name="panjangBadan" class="w-full border p-2 rounded" required>
                </div>
                <div>
                    <label>Berat Badan (kg)</label>
                    <input type="number" name="beratBadan" class="w-full border p-2 rounded" step="0.1" required>
                </div>
                <div>
                    <label>Jenis Kelamin</label>
                    <select name="jenisKelamin" class="w-full border p-2 rounded" required>
                        <option value="">Pilih...</option>
                        <option value="Laki-laki">Laki-laki</option>
                        <option value="Perempuan">Perempuan</option>
                    </select>
                </div>
                <div>
                    <label>Nama Ortu</label>
                    <input type="text" name="namaOrtu" class="w-full border p-2 rounded" required>
                </div>
                <div>
                    <label>Kelurahan</label>
                    <input type="text" name="kelurahan" class="w-full border p-2 rounded" required>
                </div>
                <div>
                    <label>RT/RW</label>
                    <input type="text" name="rtrw" class="w-full border p-2 rounded" required>
                </div>
                <div class="md:col-span-2">
                    <label>Email</label>
                    <input type="email" name="email" class="w-full border p-2 rounded">
                </div>
                <div class="md:col-span-2">
                    <label>Jenis Vaksin</label><br>
                    <input type="checkbox" name="jenisVaksin" value="BCG"> BCG
                    <input type="checkbox" name="jenisVaksin" value="Polio"> Polio
                    <input type="checkbox" name="jenisVaksin" value="DPT"> DPT
                </div>
                <div class="md:col-span-2 flex justify-end space-x-4">
                    <button type="reset" class="px-4 py-2 bg-gray-500 text-white rounded">Batal</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Rekap -->
    <div id="rekap" class="page hidden">
        <div class="card">
            <h2 class="text-xl font-bold mb-4">Rekap Data Imunisasi</h2>
            <table id="rekapTable">
                <thead>
                    <tr>
                        <th>NIK Anak</th>
                        <th>Nama Bayi</th>
                        <th>Tanggal Imunisasi</th>
                        <th>Jenis Vaksin</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
const GAS_URL = "PASTE_URL_WEB_APP_ANDA_DISINI";

// Navigasi
document.querySelectorAll(".nav-item").forEach(nav => {
    nav.addEventListener("click", () => {
        document.querySelectorAll(".nav-item").forEach(n => n.classList.remove("active-page"));
        nav.classList.add("active-page");
        document.querySelectorAll(".page").forEach(p => p.classList.add("hidden"));
        document.getElementById(nav.dataset.page).classList.remove("hidden");

        if (nav.dataset.page === "rekap") loadRekap();
    });
});

// Simpan data
document.getElementById("imunisasiForm").addEventListener("submit", async e => {
    e.preventDefault();
    const form = e.target;
    const formData = Object.fromEntries(new FormData(form).entries());

    // Ambil checkbox vaksin
    formData.jenisVaksin = [...form.querySelectorAll('input[name="jenisVaksin"]:checked')].map(c => c.value);

    try {
        const res = await fetch(GAS_URL, {
            method: "POST",
            body: JSON.stringify(formData)
        });
        const json = await res.json();
        alert(json.message || "Data tersimpan");
        form.reset();
    } catch (err) {
        console.error(err);
        alert("Gagal menyimpan data");
    }
});

// Ambil data Rekap
async function loadRekap() {
    try {
        const res = await fetch(GAS_URL);
        const json = await res.json();
        const tbody = document.querySelector("#rekapTable tbody");
        tbody.innerHTML = "";

        if (json.status === "success") {
            json.data.forEach(row => {
                let tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${row["NIK Anak"] || ""}</td>
                    <td>${row["Nama Bayi"] || ""}</td>
                    <td>${row["Tanggal Imunisasi"] || ""}</td>
                    <td>${row["Jenis Vaksin"] || ""}</td>
                `;
                tbody.appendChild(tr);
            });
        }
    } catch (err) {
        console.error(err);
        alert("Gagal memuat data rekap");
    }
}
</script>
</body>
</html>
